# ドキュメントとソースコードの整合性チェック報告書

作成日: 2026年1月28日

## 1. UI/UX設計書（docs/ui-ux-design.md）の整合性チェック

### ✅ 整合している点

1. **ナビゲーション構造**
   - Bottom Tab Navigatorの実装が一致
   - 画面構成（CameraScreen, RecipeEditScreen, RecipeListScreen, SettingsScreen）が一致
   - タブ構成が一致（スキャン、計算、保存）

2. **カラーパレット**
   - プライマリカラー（#FF6B35）が使用されている
   - セカンダリカラー（#004E89）がButtonコンポーネントで使用されている
   - ニュートラルカラー（背景、テキスト、ボーダー）が適切に使用されている

3. **レシピ編集画面の基本機能**
   - タイトル入力フィールドが実装されている
   - 基準材料選択が実装されている（Alertベースの簡易実装）
   - スケーリング機能が実装されている（ボタンによる調整）
   - 材料リストの表示が実装されている
   - チェックボックス（計量済み）が実装されている
   - ロック機能が実装されている
   - ベーカーズパーセントの表示が実装されている

4. **レシピ一覧画面の基本機能**
   - レシピカードの表示が実装されている
   - お気に入り機能が実装されている
   - 削除機能が実装されている
   - 空状態の表示が実装されている

5. **共通コンポーネント**
   - Buttonコンポーネントが実装されている（variant, size, disabled対応）
   - Inputコンポーネントが実装されている（label, error, keyboardType対応）

### ❌ 不整合な点（詳細）

#### 1.1 カメラ画面（CameraScreen）

**ドキュメントの記載**:
- Vision Cameraのプレビュー（30FPS）
- ARオーバーレイ（Skia、60FPS）
- リアルタイムOCR処理（「OCR開始」ボタン）
- カメラフレーム上での材料タップ・長押しインタラクション

**実装状況**:
- ❌ Vision Cameraは未実装（`expo-image-picker`を使用）
- ❌ ARオーバーレイは未実装
- ❌ リアルタイムOCRは未実装（静止画OCRのみ）
- ❌ カメラプレビュー上でのインタラクションは未実装
- ✅ 静止画撮影・選択機能は実装済み
- ✅ OCR結果の表示は実装済み（リスト形式）

**推奨修正**:
- Vision Camera + Frame Processorの実装が必要
- Skiaを使用したARオーバーレイの実装が必要
- リアルタイムOCR処理の実装が必要
- Development Buildが必要（Expo Goでは動作しない）

#### 1.2 スプラッシュ画面

**ドキュメントの記載**:
- アプリ起動時のスプラッシュ画面
- アプリロゴ、ローディングインジケーター、バージョン情報

**実装状況**:
- ❌ スプラッシュ画面は未実装

**推奨修正**:
- `App.tsx`にスプラッシュ画面を追加
- 初期化処理（Supabase接続確認など）を実装

#### 1.3 レシピ編集画面のUI要素

**ドキュメントの記載**:
- ScalingSliderコンポーネント（0.1倍～5.0倍のスライダー）
- IngredientItemコンポーネント（独立コンポーネント）
- TimerButtonコンポーネント（タイマー起動）
- BakersPercentButtonコンポーネント（表示切り替え）
- 微量材料の強調表示（警告アイコン）

**実装状況**:
- ❌ ScalingSliderは未実装（+/-ボタンによる調整のみ）
- ❌ IngredientItemは独立コンポーネントとして未実装（インライン実装）
- ❌ TimerButtonは未実装
- ❌ BakersPercentButtonは未実装（常時表示）
- ❌ 微量材料の強調表示は未実装

**推奨修正**:
- `src/components/recipe/ScalingSlider.tsx`を作成
- `src/components/recipe/IngredientItem.tsx`を作成
- `src/components/recipe/TimerButton.tsx`を作成
- `src/components/recipe/BakersPercentButton.tsx`を作成
- 微量材料の判定ロジックを追加（`is_micro_ingredient`フラグの使用）

#### 1.4 レシピ一覧画面のUI要素

**ドキュメントの記載**:
- RecipeCardコンポーネント（独立コンポーネント）
- SearchBarコンポーネント（リアルタイム検索）
- サムネイル画像の表示（OCR元画像）

**実装状況**:
- ❌ RecipeCardは独立コンポーネントとして未実装（インライン実装）
- ❌ SearchBarは未実装
- ❌ サムネイル画像の表示は未実装

**推奨修正**:
- `src/components/recipe/RecipeCard.tsx`を作成
- `src/components/common/SearchBar.tsx`を作成
- 画像表示機能を追加（`source_image_url`の使用）

#### 1.5 設定画面（SettingsScreen）

**ドキュメントの記載**:
- ARオーバーレイのON/OFFトグル
- 丸めモードのセレクター（整数/小数）
- 小数点桁数のセレクター
- アカウント設定（ログイン/ログアウト）
- バージョン情報、利用規約、プライバシーポリシー

**実装状況**:
- ❌ ARオーバーレイのON/OFFトグルは未実装
- ✅ 丸めモードの切り替えは実装済み（Switch）
- ❌ 小数点桁数の設定は未実装
- ❌ アカウント設定は未実装
- ✅ バージョン情報は実装済み（簡易版）
- ❌ 利用規約、プライバシーポリシーは未実装

**推奨修正**:
- ARオーバーレイ設定を追加（`user_settings`テーブルと連携）
- 小数点桁数の設定UIを追加
- Supabase Authを使用した認証機能を実装
- 利用規約・プライバシーポリシーの画面を追加

#### 1.6 エラー状態のUI

**ドキュメントの記載**:
- OCRエラー時の表示（「再試行」「手動入力」ボタン）
- ネットワークエラー時の表示（オフライン状態の表示）
- 保存エラー時の表示（「再試行」ボタン）

**実装状況**:
- ⚠️ OCRエラー時はAlertのみ（専用UIなし）
- ❌ ネットワークエラー時の専用UIは未実装
- ⚠️ 保存エラー時はAlertのみ（専用UIなし）

**推奨修正**:
- エラー状態用のコンポーネントを作成
- オフライン状態の検知と表示を実装

#### 1.7 アニメーション・トランジション

**ドキュメントの記載**:
- スライダー操作時のリアルタイム更新アニメーション
- チェックボックスのフェードアニメーション
- ARオーバーレイの数値変更時のフェードアニメーション

**実装状況**:
- ❌ アニメーションは未実装（即座に更新）

**推奨修正**:
- React Native Animated APIを使用したアニメーションを追加

#### 1.8 アクセシビリティ

**ドキュメントの記載**:
- スクリーンリーダー対応（VoiceOver、TalkBack）
- コントラスト比の確保（WCAG AA準拠）
- タップ領域の最小サイズ（44x44pt）
- アクセシビリティラベルの設定

**実装状況**:
- ❌ アクセシビリティラベルは未設定
- ⚠️ コントラスト比・タップ領域は部分的に確保されている

**推奨修正**:
- すべてのインタラクティブ要素に`accessibilityLabel`を追加
- `accessibilityHint`、`accessibilityRole`を設定

---

## 2. 技術仕様書（docs/technical-specification.md）の整合性チェック

### ✅ 整合している点

1. **スケーリング計算ロジック**
   - 基本計算式（Target = Original × Ratio）が実装されている
   - ロック機能が実装されている
   - 丸め処理が実装されている

2. **ベーカーズパーセント計算**
   - 計算式が実装されている
   - 粉類の総重量からの計算が実装されている

3. **単位変換**
   - `convertUnit`関数が実装されている
   - 重量・体積単位の判定が実装されている

4. **状態管理（Zustand）**
   - Storeの構造が適切に実装されている
   - 自動再計算機能が実装されている

5. **OCRテキスト抽出ロジック**
   - Y座標による行の紐付けが実装されている（`ocr-parser.ts`）
   - 材料名・数値・単位の抽出が実装されている

### ❌ 不整合な点（詳細）

#### 2.1 OCR処理仕様

**ドキュメントの記載**:
- Vision Cameraの設定（30FPS、yuv形式）
- Frame Processor実装（リアルタイムOCR）
- ML Kit OCRの使用

**実装状況**:
- ❌ Vision Cameraは未実装
- ❌ Frame Processorは未実装
- ❌ ML Kit OCRは未実装（Cloud Vision APIを使用）
- ✅ テキスト抽出ロジックは実装済み（`ocr-parser.ts`）

**推奨修正**:
- `react-native-vision-camera`を導入
- `@bear-block/vision-camera-ocr`を導入
- Frame Processorを実装
- Development Buildが必要

#### 2.2 ARオーバーレイ描画仕様

**ドキュメントの記載**:
- Skia Canvasを使用したARオーバーレイ
- 60FPS描画の最適化
- 座標変換（カメラフレーム → 画面座標）
- 計量済み材料のグレーアウト表示

**実装状況**:
- ❌ ARオーバーレイは完全に未実装
- ❌ Skiaは未導入

**推奨修正**:
- `@shopify/react-native-skia`を導入
- `AROverlay`コンポーネントを作成
- 座標変換関数を実装
- メモ化による最適化を実装
- Development Buildが必要

#### 2.3 パフォーマンス最適化

**ドキュメントの記載**:
- Frame Processor内でのフレームスキップ
- OCR結果のデバウンス
- メモリ管理（画像の解放）

**実装状況**:
- ❌ Frame Processorが未実装のため、最適化も未実装
- ⚠️ メモリ管理は部分的に実装（useEffectでのクリーンアップ）

**推奨修正**:
- Frame Processor実装時に最適化を追加
- 画像のメモリリーク防止を強化

#### 2.4 エラーハンドリング

**ドキュメントの記載**:
- OCRエラーの詳細な分類（タイムアウト、テキスト未認識など）
- 計算エラーの入力値検証

**実装状況**:
- ⚠️ OCRエラーは基本的なtry-catchのみ
- ✅ 計算エラーは入力値検証が実装されている（倍率の範囲制限）

**推奨修正**:
- OCRエラーの詳細な分類を追加
- エラーコードの定義と処理を追加

#### 2.5 テスト仕様

**ドキュメントの記載**:
- ユニットテスト（計算ロジック）
- 統合テスト（OCR → 計算 → 表示のフロー）

**実装状況**:
- ❌ テストは未実装

**推奨修正**:
- Jest + React Native Testing Libraryを使用したテストを追加
- 計算ロジックのユニットテストを作成
- 統合テストを作成

---

## 3. まとめ

### 実装済み機能

1. ✅ 基本的なレシピ管理機能（CRUD）
2. ✅ スケーリング計算ロジック
3. ✅ ベーカーズパーセント計算
4. ✅ OCR処理（Cloud Vision API、静止画）
5. ✅ 材料リストの表示・編集
6. ✅ 状態管理（Zustand）

### 未実装機能（重要度順）

#### 高優先度

1. **Vision Camera + リアルタイムOCR**
   - カメラ画面の核心機能
   - Development Buildが必要

2. **ARオーバーレイ**
   - カメラ画面の主要機能
   - Skiaの導入が必要

3. **スライダーコンポーネント**
   - レシピ編集画面のUX向上

#### 中優先度

4. **独立コンポーネントの作成**
   - IngredientItem、RecipeCard、SearchBarなど
   - コードの保守性向上

5. **設定画面の機能拡充**
   - ARオーバーレイ設定、小数点桁数設定
   - 認証機能

6. **エラー状態のUI改善**
   - 専用エラー画面の作成

#### 低優先度

7. **スプラッシュ画面**
   - アプリ起動時のUX向上

8. **アニメーション**
   - UIの滑らかさ向上

9. **アクセシビリティ対応**
   - スクリーンリーダー対応

10. **テスト実装**
    - 品質保証

### 推奨される開発順序

1. **フェーズ1: 基本機能の完成**（現在）
   - ✅ 完了済み

2. **フェーズ2: Development Buildの準備**
   - EAS CLIのセットアップ
   - Development Buildの作成

3. **フェーズ3: カメラ機能の実装**
   - Vision Cameraの導入
   - Frame Processorの実装
   - ML Kit OCRの統合

4. **フェーズ4: ARオーバーレイの実装**
   - Skiaの導入
   - ARオーバーレイコンポーネントの作成
   - 座標変換の実装

5. **フェーズ5: UI改善**
   - スライダーコンポーネント
   - 独立コンポーネントの作成
   - エラー状態のUI改善

6. **フェーズ6: 機能拡充**
   - 設定画面の機能追加
   - 認証機能
   - テスト実装

---

## 4. 補足情報

### 現在の実装アーキテクチャ

- **OCR処理**: Cloud Vision API（静止画）
- **カメラ**: expo-image-picker（静止画撮影・選択）
- **状態管理**: Zustand
- **ナビゲーション**: React Navigation（Bottom Tab + Stack）

### ドキュメントで想定されているアーキテクチャ

- **OCR処理**: ML Kit OCR（リアルタイム）
- **カメラ**: react-native-vision-camera（リアルタイムプレビュー）
- **AR描画**: @shopify/react-native-skia（60FPS）
- **状態管理**: Zustand（一致）
- **ナビゲーション**: React Navigation（一致）

### 技術的制約

- **Expo Goの制限**: Vision Camera、Skia、ML Kit OCRはExpo Goでは動作しない
- **Development Buildが必要**: これらの機能を実装するには、カスタムビルドが必要

### ドキュメント更新の推奨事項

1. **現在の実装状況を明記**
   - Cloud Vision APIを使用していることを記載
   - Development Buildが必要な機能を明示

2. **段階的な実装計画を追加**
   - フェーズ1（基本機能）は完了
   - フェーズ2以降の実装計画を明確化

3. **代替実装の記載**
   - Expo Goで動作する実装（ImagePicker）と、将来の実装（Vision Camera）を区別
