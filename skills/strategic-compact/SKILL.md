---

## name: strategic-compact description: 恣意的な自動圧縮ではなく、タスクフェーズを通じてコンテキストを維持するために、論理的な間隔での手動コンテキスト圧縮を提案します。

# 戦略的コンパクトスキル (Strategic Compact Skill)

恣意的な自動圧縮に頼るのではなく、ワークフロー内の戦略的なポイントで手動の `Composerのコンテキストクリア機能` を提案します。

## なぜ戦略的圧縮なのか？ (Why Strategic Compaction?)

自動圧縮は恣意的なポイントでトリガーされます：

* しばしばタスクの途中で発生し、重要なコンテキストを失う
* 論理的なタスクの境界を認識しない
* 複雑なマルチステップ操作を中断させる可能性がある

論理的な境界での戦略的圧縮：

* **探索後、実行前** - リサーチコンテキストを圧縮し、実装計画を維持する
* **マイルストーン完了後** - 次のフェーズのためにフレッシュな状態で開始する
* **主要なコンテキストシフトの前** - 異なるタスクに移る前に探索コンテキストをクリアする

## 仕組み (How It Works)

`suggest-compact.sh` スクリプトは PreToolUse (Edit/Write) で実行され、以下を行います：

1. **ツール呼び出しの追跡** - セッション内のツール呼び出し回数をカウントする
2. **閾値検出** - 設定可能な閾値（デフォルト: 50回）で提案する
3. **定期的リマインダー** - 閾値を超えた後、25回ごとにリマインドする

## フックのセットアップ (Hook Setup)

`~/.cursor/settings.json` に追加します：

```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "tool == \"Edit\" || tool == \"Write\"",
      "hooks": [{
        "type": "command",
        "command": "~/.cursor/skills/strategic-compact/suggest-compact.sh"
      }]
    }]
  }
}

```

## 設定 (Configuration)

環境変数：

* `COMPACT_THRESHOLD` - 最初の提案までのツール呼び出し回数 (デフォルト: 50)

## ベストプラクティス (Best Practices)

1. **計画後に圧縮する** - 計画が確定したら、圧縮してフレッシュな状態で開始する
2. **デバッグ後に圧縮する** - 継続する前にエラー解決のコンテキストをクリアする
3. **実装途中では圧縮しない** - 関連する変更のためにコンテキストを保存する
4. **提案を読む** - フックは「いつ」を伝えますが、「するかどうか」を決めるのはあなたです

## 関連情報 (Related)

* [The Longform Guide](https://x.com/affaanmustafa/status/2014040193557471352) - トークン最適化のセクション
* メモリ永続化フック - 圧縮後も残る状態のために
